# ğŸ§ª æµ‹è¯•æ–°æ‰‹å…¥é—¨æ•™ç¨‹

æ¬¢è¿æ¥åˆ°æµ‹è¯•çš„ä¸–ç•Œï¼æµ‹è¯•ä¸ä»…æ˜¯ä¿è¯ä»£ç è´¨é‡çš„å·¥å…·ï¼Œæ›´æ˜¯ç†è§£å’Œå­¦ä¹ é¡¹ç›®çš„æœ€ä½³é€”å¾„ã€‚è®©æˆ‘ä»¬ä»é›¶å¼€å§‹ï¼Œä¸€æ­¥æ­¥æŒæ¡æµ‹è¯•çš„è‰ºæœ¯ã€‚

## ğŸ¯ ä¸ºä»€ä¹ˆè¦å­¦ä¹ æµ‹è¯•ï¼Ÿ

### å¯¹æ–°æ‰‹çš„å¥½å¤„
- **ç†è§£ä»£ç é€»è¾‘** - æµ‹è¯•ç”¨ä¾‹å°±æ˜¯åŠŸèƒ½è¯´æ˜ä¹¦
- **å®‰å…¨é‡æ„** - æœ‰æµ‹è¯•ä¿æŠ¤ï¼Œæ”¹ä»£ç ä¸æ€•å‡ºé”™
- **æå‡ä¿¡å¿ƒ** - ç»¿è‰²çš„æµ‹è¯•ç»“æœç»™ä½ æ»¡æ»¡æˆå°±æ„Ÿ
- **å­¦ä¹ æœ€ä½³å®è·µ** - ä¼˜ç§€çš„æµ‹è¯•ä»£ç æ•™ä½ å¦‚ä½•å†™å¥½ä»£ç 

### æµ‹è¯•çš„ä¸‰å¤§ç±»å‹
```
ğŸ—ï¸ å•å…ƒæµ‹è¯• (Unit Tests)
   â”œâ”€â”€ æµ‹è¯•å•ä¸ªå‡½æ•°æˆ–ç»„ä»¶
   â”œâ”€â”€ è¿è¡Œé€Ÿåº¦å¿«
   â””â”€â”€ æ•°é‡æœ€å¤š (70%)

ğŸ”— é›†æˆæµ‹è¯• (Integration Tests)  
   â”œâ”€â”€ æµ‹è¯•æ¨¡å—é—´çš„åä½œ
   â”œâ”€â”€ éªŒè¯æ•°æ®æµ
   â””â”€â”€ é€‚ä¸­æ•°é‡ (20%)

ğŸ­ ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
   â”œâ”€â”€ æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ
   â”œâ”€â”€ æµ‹è¯•å®Œæ•´æµç¨‹
   â””â”€â”€ æ•°é‡æœ€å°‘ (10%)
```

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šç†è§£æµ‹è¯•ç»“æ„

### åŸºæœ¬æµ‹è¯•è¯­æ³•
```typescript
// åŸºç¡€ç»“æ„
describe("åŠŸèƒ½æ¨¡å—åç§°", () => {
  it("åº”è¯¥åšä»€ä¹ˆäº‹æƒ…", () => {
    // å‡†å¤‡ (Arrange)
    const input = "æµ‹è¯•è¾“å…¥";
    
    // æ‰§è¡Œ (Act)  
    const result = functionToTest(input);
    
    // æ–­è¨€ (Assert)
    expect(result).toBe("æœŸæœ›è¾“å‡º");
  });
});
```

### å®é™…ä¾‹å­ï¼šæµ‹è¯•åº”ç”¨æåŠåŠŸèƒ½
```typescript
// src/__tests__/mention_apps.test.ts
describe("parseAppMentions", () => {
  it("should parse basic app mentions", () => {
    // å‡†å¤‡ï¼šåˆ›å»ºåŒ…å«åº”ç”¨æåŠçš„æ–‡æœ¬
    const prompt = "Can you help me with @app:MyApp and @app:AnotherApp?";
    
    // æ‰§è¡Œï¼šè°ƒç”¨è§£æå‡½æ•°
    const result = parseAppMentions(prompt);
    
    // æ–­è¨€ï¼šéªŒè¯ç»“æœ
    expect(result).toEqual(["MyApp", "AnotherApp"]);
  });
});
```

## ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šåŠ¨æ‰‹å†™ä½ çš„ç¬¬ä¸€ä¸ªæµ‹è¯•

### åˆ›å»ºæµ‹è¯•æ–‡ä»¶
```bash
# åœ¨ src/__tests__ ç›®å½•ä¸‹åˆ›å»ºæµ‹è¯•æ–‡ä»¶
touch src/__tests__/my_first_test.test.ts
```

### ç¼–å†™ç®€å•çš„å·¥å…·å‡½æ•°æµ‹è¯•
```typescript
// src/utils/string_utils.ts (å…ˆåˆ›å»ºè¦æµ‹è¯•çš„å‡½æ•°)
export function capitalize(str: string): string {
  if (!str) return "";
  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}

export function reverseString(str: string): string {
  return str.split("").reverse().join("");
}
```

```typescript
// src/__tests__/string_utils.test.ts
import { capitalize, reverseString } from "../utils/string_utils";

describe("String Utils", () => {
  describe("capitalize", () => {
    it("should capitalize first letter", () => {
      expect(capitalize("hello")).toBe("Hello");
    });

    it("should handle empty string", () => {
      expect(capitalize("")).toBe("");
    });

    it("should handle single character", () => {
      expect(capitalize("a")).toBe("A");
    });

    it("should lowercase other letters", () => {
      expect(capitalize("hELLO")).toBe("Hello");
    });
  });

  describe("reverseString", () => {
    it("should reverse a string", () => {
      expect(reverseString("hello")).toBe("olleh");
    });

    it("should handle empty string", () => {
      expect(reverseString("")).toBe("");
    });
  });
});
```

### è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ªæµ‹è¯•
```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test src/__tests__/string_utils.test.ts

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘è§†æ¨¡å¼ï¼ˆæ–‡ä»¶æ”¹å˜æ—¶è‡ªåŠ¨è¿è¡Œï¼‰
npm run test:watch
```

## ğŸ­ ç¬¬ä¸‰æ­¥ï¼šç†è§£ Mockï¼ˆæ¨¡æ‹Ÿï¼‰

### ä»€ä¹ˆæ˜¯ Mockï¼Ÿ
Mock å°±æ˜¯"æ›¿èº«æ¼”å‘˜"ï¼Œç”¨æ¥æ¨¡æ‹ŸçœŸå®çš„ä¾èµ–ï¼Œè®©æµ‹è¯•æ›´å¯æ§ã€‚

### åŸºç¡€ Mock ç¤ºä¾‹
```typescript
// src/services/api.ts
export async function fetchUserData(userId: string) {
  const response = await fetch(`/api/users/${userId}`);
  return response.json();
}

export function processUserData(userData: any) {
  return {
    name: userData.name.toUpperCase(),
    email: userData.email.toLowerCase(),
    isActive: userData.status === 'active'
  };
}
```

```typescript
// src/__tests__/api.test.ts
import { vi } from 'vitest';
import { fetchUserData, processUserData } from '../services/api';

// Mock fetch å‡½æ•°
global.fetch = vi.fn();

describe("API Service", () => {
  beforeEach(() => {
    // æ¯ä¸ªæµ‹è¯•å‰é‡ç½® mock
    vi.clearAllMocks();
  });

  describe("fetchUserData", () => {
    it("should fetch user data", async () => {
      // è®¾ç½® mock è¿”å›å€¼
      const mockUser = { id: "1", name: "John", email: "john@example.com" };
      (fetch as any).mockResolvedValue({
        json: () => Promise.resolve(mockUser)
      });

      const result = await fetchUserData("1");
      
      expect(fetch).toHaveBeenCalledWith("/api/users/1");
      expect(result).toEqual(mockUser);
    });
  });

  describe("processUserData", () => {
    it("should process user data correctly", () => {
      const input = {
        name: "john doe",
        email: "JOHN@EXAMPLE.COM",
        status: "active"
      };

      const result = processUserData(input);

      expect(result).toEqual({
        name: "JOHN DOE",
        email: "john@example.com", 
        isActive: true
      });
    });
  });
});
```

## ğŸ” ç¬¬å››æ­¥ï¼šå­¦ä¹ æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD)

### TDD ä¸‰æ­¥æ³•ï¼šçº¢-ç»¿-é‡æ„
```
ğŸ”´ çº¢è‰²ï¼šå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•
ğŸŸ¢ ç»¿è‰²ï¼šå†™æœ€å°‘çš„ä»£ç è®©æµ‹è¯•é€šè¿‡  
ğŸ”µ é‡æ„ï¼šæ”¹è¿›ä»£ç è´¨é‡
```

### TDD å®è·µï¼šå¼€å‘è®¡ç®—å™¨
```typescript
// ç¬¬ä¸€æ­¥ï¼šå†™æµ‹è¯•ï¼ˆçº¢è‰²ï¼‰
describe("Calculator", () => {
  it("should add two numbers", () => {
    const calc = new Calculator();
    expect(calc.add(2, 3)).toBe(5);
  });
});

// ç¬¬äºŒæ­¥ï¼šå†™å®ç°ï¼ˆç»¿è‰²ï¼‰
class Calculator {
  add(a: number, b: number): number {
    return a + b; // æœ€ç®€å®ç°
  }
}

// ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ›´å¤šæµ‹è¯•
it("should handle negative numbers", () => {
  const calc = new Calculator();
  expect(calc.add(-2, 3)).toBe(1);
});

it("should handle decimal numbers", () => {
  const calc = new Calculator();
  expect(calc.add(0.1, 0.2)).toBeCloseTo(0.3);
});
```

## ğŸ¯ ç¬¬äº”æ­¥ï¼šReact ç»„ä»¶æµ‹è¯•

### æµ‹è¯• React ç»„ä»¶
```typescript
// src/components/Counter.tsx
import React, { useState } from 'react';

interface CounterProps {
  initialValue?: number;
}

export const Counter: React.FC<CounterProps> = ({ initialValue = 0 }) => {
  const [count, setCount] = useState(initialValue);

  return (
    <div>
      <span data-testid="count">{count}</span>
      <button 
        data-testid="increment" 
        onClick={() => setCount(count + 1)}
      >
        +
      </button>
      <button 
        data-testid="decrement" 
        onClick={() => setCount(count - 1)}
      >
        -
      </button>
    </div>
  );
};
```

```typescript
// src/__tests__/Counter.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Counter } from '../components/Counter';

describe("Counter Component", () => {
  it("should render with initial value", () => {
    render(<Counter initialValue={5} />);
    
    expect(screen.getByTestId("count")).toHaveTextContent("5");
  });

  it("should increment count when + button clicked", () => {
    render(<Counter />);
    
    const incrementButton = screen.getByTestId("increment");
    fireEvent.click(incrementButton);
    
    expect(screen.getByTestId("count")).toHaveTextContent("1");
  });

  it("should decrement count when - button clicked", () => {
    render(<Counter initialValue={5} />);
    
    const decrementButton = screen.getByTestId("decrement");
    fireEvent.click(decrementButton);
    
    expect(screen.getByTestId("count")).toHaveTextContent("4");
  });
});
```

## ğŸ­ ç¬¬å…­æ­¥ï¼šç«¯åˆ°ç«¯æµ‹è¯•å…¥é—¨

### ä»€ä¹ˆæ˜¯ E2E æµ‹è¯•ï¼Ÿ
E2E æµ‹è¯•æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼Œæµ‹è¯•æ•´ä¸ªåº”ç”¨æµç¨‹ã€‚

### ç®€å•çš„ E2E æµ‹è¯•ç¤ºä¾‹
```typescript
// e2e-tests/basic_flow.spec.ts
import { test, expect } from '@playwright/test';

test('user can create and complete a todo', async ({ page }) => {
  // 1. è®¿é—®åº”ç”¨
  await page.goto('/');
  
  // 2. æ·»åŠ æ–°ä»»åŠ¡
  await page.fill('[data-testid="todo-input"]', 'Learn testing');
  await page.click('[data-testid="add-button"]');
  
  // 3. éªŒè¯ä»»åŠ¡å·²æ·»åŠ 
  await expect(page.locator('[data-testid="todo-item"]')).toContainText('Learn testing');
  
  // 4. æ ‡è®°ä»»åŠ¡å®Œæˆ
  await page.click('[data-testid="todo-checkbox"]');
  
  // 5. éªŒè¯ä»»åŠ¡å·²å®Œæˆ
  await expect(page.locator('[data-testid="todo-item"]')).toHaveClass(/completed/);
});
```

## ğŸ“š ç¬¬ä¸ƒæ­¥ï¼šæµ‹è¯•æœ€ä½³å®è·µ

### å¥½çš„æµ‹è¯•ç‰¹å¾ï¼šFIRST åŸåˆ™
- **F**ast - å¿«é€Ÿè¿è¡Œ
- **I**ndependent - ç‹¬ç«‹è¿è¡Œ
- **R**epeatable - å¯é‡å¤
- **S**elf-validating - è‡ªæˆ‘éªŒè¯
- **T**imely - åŠæ—¶ç¼–å†™

### æµ‹è¯•å‘½åè§„èŒƒ
```typescript
// âŒ ä¸å¥½çš„å‘½å
it("test user function", () => {});

// âœ… å¥½çš„å‘½å
it("should return user profile when valid ID provided", () => {});
it("should throw error when user ID is empty", () => {});
it("should handle network timeout gracefully", () => {});
```

### æµ‹è¯•ç»„ç»‡ç»“æ„
```typescript
describe("UserService", () => {
  describe("getUserById", () => {
    describe("when user exists", () => {
      it("should return user profile", () => {});
      it("should include user permissions", () => {});
    });

    describe("when user does not exist", () => {
      it("should return null", () => {});
    });

    describe("when network error occurs", () => {
      it("should throw NetworkError", () => {});
    });
  });
});
```

## ğŸ› ï¸ ç¬¬å…«æ­¥ï¼šå®æˆ˜ç»ƒä¹ 

### ç»ƒä¹  1ï¼šæµ‹è¯•è¡¨å•éªŒè¯
```typescript
// åˆ›å»ºä¸€ä¸ªè¡¨å•éªŒè¯å‡½æ•°å¹¶ä¸ºå…¶ç¼–å†™æµ‹è¯•
export function validateEmail(email: string): { isValid: boolean; error?: string } {
  // ä½ çš„å®ç°
}

// æµ‹è¯•ç”¨ä¾‹åº”è¯¥è¦†ç›–ï¼š
// - æœ‰æ•ˆé‚®ç®±
// - æ— æ•ˆé‚®ç®±æ ¼å¼
// - ç©ºå­—ç¬¦ä¸²
// - ç‰¹æ®Šå­—ç¬¦
```

### ç»ƒä¹  2ï¼šæµ‹è¯•å¼‚æ­¥æ“ä½œ
```typescript
// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°å¹¶æµ‹è¯•å®ƒ
export async function saveUserProfile(profile: UserProfile): Promise<SaveResult> {
  // ä½ çš„å®ç°
}

// æµ‹è¯•ç”¨ä¾‹åº”è¯¥è¦†ç›–ï¼š
// - æˆåŠŸä¿å­˜
// - ç½‘ç»œé”™è¯¯
// - éªŒè¯å¤±è´¥
// - è¶…æ—¶å¤„ç†
```

### ç»ƒä¹  3ï¼šæµ‹è¯• React Hook
```typescript
// åˆ›å»ºè‡ªå®šä¹‰ Hook å¹¶æµ‹è¯•
export function useCounter(initialValue = 0) {
  // ä½ çš„å®ç°
}

// æµ‹è¯•ç”¨ä¾‹åº”è¯¥è¦†ç›–ï¼š
// - åˆå§‹å€¼è®¾ç½®
// - å¢åŠ æ“ä½œ
// - å‡å°‘æ“ä½œ
// - é‡ç½®åŠŸèƒ½
```

## ğŸ¯ ç¬¬ä¹æ­¥ï¼šè°ƒè¯•æµ‹è¯•

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. æµ‹è¯•è¿è¡Œå¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
npm test -- --verbose

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test -- --testPathPattern=mention_apps

# åªè¿è¡ŒåŒ¹é…çš„æµ‹è¯•
npm test -- --testNamePattern="should parse"
```

#### 2. å¼‚æ­¥æµ‹è¯•é—®é¢˜
```typescript
// âŒ é”™è¯¯ï¼šå¿˜è®°ç­‰å¾…å¼‚æ­¥æ“ä½œ
it("should fetch data", () => {
  fetchData().then(result => {
    expect(result).toBeDefined(); // è¿™ä¸ªæ–­è¨€å¯èƒ½ä¸ä¼šæ‰§è¡Œ
  });
});

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ async/await
it("should fetch data", async () => {
  const result = await fetchData();
  expect(result).toBeDefined();
});
```

#### 3. Mock æ²¡æœ‰ç”Ÿæ•ˆ
```typescript
// âŒ é”™è¯¯ï¼šMock è®¾ç½®åœ¨é”™è¯¯çš„ä½ç½®
it("should use mocked function", () => {
  vi.mock('./api'); // å¤ªæ™šäº†
  // æµ‹è¯•ä»£ç 
});

// âœ… æ­£ç¡®ï¼šåœ¨æ–‡ä»¶é¡¶éƒ¨è®¾ç½® Mock
vi.mock('./api');

describe("Test Suite", () => {
  // æµ‹è¯•ä»£ç 
});
```

## ğŸ† ç¬¬åæ­¥ï¼šè¿›é˜¶æŠ€å·§

### 1. å‚æ•°åŒ–æµ‹è¯•
```typescript
describe("Math operations", () => {
  const testCases = [
    { a: 1, b: 2, expected: 3 },
    { a: -1, b: 1, expected: 0 },
    { a: 0, b: 0, expected: 0 },
  ];

  testCases.forEach(({ a, b, expected }) => {
    it(`should add ${a} + ${b} = ${expected}`, () => {
      expect(add(a, b)).toBe(expected);
    });
  });
});
```

### 2. æµ‹è¯•è¦†ç›–ç‡
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open coverage/lcov-report/index.html
```

### 3. å¿«ç…§æµ‹è¯•
```typescript
it("should render component correctly", () => {
  const component = render(<MyComponent />);
  expect(component.container).toMatchSnapshot();
});
```

## ğŸ‰ æ­å–œä½ ï¼

ä½ å·²ç»æŒæ¡äº†æµ‹è¯•çš„åŸºç¡€çŸ¥è¯†ï¼ç°åœ¨ä½ å¯ä»¥ï¼š

âœ… ç†è§£æµ‹è¯•çš„é‡è¦æ€§å’Œç±»å‹  
âœ… ç¼–å†™åŸºæœ¬çš„å•å…ƒæµ‹è¯•  
âœ… ä½¿ç”¨ Mock æ¨¡æ‹Ÿä¾èµ–  
âœ… æµ‹è¯• React ç»„ä»¶  
âœ… ç¼–å†™ç®€å•çš„ E2E æµ‹è¯•  
âœ… éµå¾ªæµ‹è¯•æœ€ä½³å®è·µ  

## ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®

1. **æ·±å…¥å­¦ä¹  Vitest** - æŒæ¡æ›´å¤šé«˜çº§åŠŸèƒ½
2. **å­¦ä¹  Testing Library** - æ›´å¥½åœ°æµ‹è¯• React ç»„ä»¶
3. **æŒæ¡ Playwright** - ç¼–å†™å¤æ‚çš„ E2E æµ‹è¯•
4. **å­¦ä¹ æµ‹è¯•ç­–ç•¥** - äº†è§£ä»€ä¹ˆæ—¶å€™å†™ä»€ä¹ˆæµ‹è¯•
5. **å®è·µ TDD** - åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘

è®°ä½ï¼š**å¥½çš„æµ‹è¯•ä¸ä»…ä¿è¯ä»£ç è´¨é‡ï¼Œæ›´æ˜¯ä½ ç†è§£å’Œæ”¹è¿›ä»£ç çš„æœ€ä½³å·¥å…·ï¼**

ç»§ç»­ç»ƒä¹ ï¼Œä½ ä¼šå‘ç°æµ‹è¯•ä¸ä»…æœ‰è¶£ï¼Œè¿˜èƒ½è®©ä½ æˆä¸ºæ›´å¥½çš„å¼€å‘è€…ï¼ ğŸ¯