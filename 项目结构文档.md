# Dyad é¡¹ç›®ç»“æ„æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

Dyad æ˜¯ä¸€ä¸ªæœ¬åœ°è¿è¡Œçš„å¼€æº AI åº”ç”¨æ„å»ºå™¨ï¼ŒåŸºäº Electron æ¶æ„æ„å»ºã€‚å®ƒæä¾›äº†ä¸€ä¸ªå®‰å…¨çš„ IPC è¾¹ç•Œï¼Œå‰ç«¯ä½¿ç”¨ React + TanStack Routerï¼Œæ•°æ®è·å–é€šè¿‡ TanStack Query å¤„ç†ã€‚

## æ ¸å¿ƒæ¶æ„

- **åº”ç”¨ç±»å‹**: Electron æ¡Œé¢åº”ç”¨
- **å‰ç«¯æ¡†æ¶**: React 19 + TanStack Router
- **çŠ¶æ€ç®¡ç†**: Jotai + TanStack Query
- **æ•°æ®åº“**: SQLite (é€šè¿‡ better-sqlite3 + Drizzle ORM)
- **æ„å»ºå·¥å…·**: Vite + Electron Forge
- **æ ·å¼**: Tailwind CSS + Radix UI

## ç›®å½•ç»“æ„è¯¦è§£

### ğŸ—ï¸ æ ¸å¿ƒé…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| `package.json` | é¡¹ç›®ä¾èµ–å’Œè„šæœ¬é…ç½® |
| `forge.config.ts` | Electron Forge æ„å»ºé…ç½® |
| `vite.*.config.mts` | Vite æ„å»ºé…ç½®ï¼ˆä¸»è¿›ç¨‹ã€æ¸²æŸ“è¿›ç¨‹ã€é¢„åŠ è½½è„šæœ¬ã€Workerï¼‰ |
| `tsconfig.*.json` | TypeScript é…ç½®æ–‡ä»¶ |
| `drizzle.config.ts` | æ•°æ®åº“ ORM é…ç½® |

### ğŸ“ ä¸»è¦ç›®å½•

#### `/src` - æºä»£ç ç›®å½•
åº”ç”¨çš„æ ¸å¿ƒæºä»£ç ï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼š

- **`/main`** - Electron ä¸»è¿›ç¨‹ä»£ç 
- **`/ipc`** - è¿›ç¨‹é—´é€šä¿¡ (IPC) ç›¸å…³ä»£ç 
  - `ipc_client.ts` - æ¸²æŸ“è¿›ç¨‹ IPC å®¢æˆ·ç«¯
  - `ipc_host.ts` - ä¸»è¿›ç¨‹ IPC æœåŠ¡ç«¯
  - `/handlers` - IPC å¤„ç†å™¨å®ç°
- **`/components`** - React ç»„ä»¶
  - `/ui` - åŸºç¡€ UI ç»„ä»¶
  - `/chat` - èŠå¤©ç›¸å…³ç»„ä»¶
  - `/settings` - è®¾ç½®ç›¸å…³ç»„ä»¶
- **`/pages`** - é¡µé¢ç»„ä»¶
- **`/routes`** - TanStack Router è·¯ç”±é…ç½®
- **`/hooks`** - è‡ªå®šä¹‰ React Hooks
- **`/atoms`** - Jotai çŠ¶æ€åŸå­
- **`/db`** - æ•°æ®åº“æ¨¡å¼å’Œé…ç½®
- **`/lib`** - å·¥å…·åº“å’Œé€šç”¨å‡½æ•°
- **`/utils`** - å®ç”¨å·¥å…·å‡½æ•°

#### `/src/pro` - å•†ä¸šç‰ˆåŠŸèƒ½
åŒ…å« Functional Source License è®¸å¯çš„å•†ä¸šåŠŸèƒ½ä»£ç ã€‚

#### `/packages` - å†…éƒ¨åŒ…
- **`@dyad-sh/nextjs-webpack-component-tagger`** - Next.js ç»„ä»¶æ ‡è®°å·¥å…·
- **`@dyad-sh/react-vite-component-tagger`** - React Vite ç»„ä»¶æ ‡è®°å·¥å…·

#### `/workers` - Web Workers
- **`/tsc`** - TypeScript ç¼–è¯‘ Worker

#### `/scripts` - æ„å»ºå’Œç»´æŠ¤è„šæœ¬
- `verify-release-assets.js` - å‘å¸ƒèµ„æºéªŒè¯
- `clear_console_logs.py` - æ¸…ç†æ§åˆ¶å°æ—¥å¿—

#### `/tools` - å¼€å‘å·¥å…·
- `add-macos-cert.sh` - macOS è¯ä¹¦æ·»åŠ è„šæœ¬

#### `/docs` - é¡¹ç›®æ–‡æ¡£

#### `/assets` - é™æ€èµ„æºæ–‡ä»¶

#### `/testing` - æµ‹è¯•ç›¸å…³æ–‡ä»¶

#### `/e2e-tests` - ç«¯åˆ°ç«¯æµ‹è¯•

#### `/scaffold` - é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿

#### `/shared` - å…±äº«ä»£ç å’Œç±»å‹å®šä¹‰

#### `/drizzle` - æ•°æ®åº“è¿ç§»æ–‡ä»¶

### ğŸ”§ é…ç½®ç›®å½•

#### `/.kiro` - Kiro IDE é…ç½®
åŒ…å« Kiro IDE çš„é¡¹ç›®ç‰¹å®šé…ç½®ã€‚

#### `/.vscode` - VS Code é…ç½®
VS Code ç¼–è¾‘å™¨çš„é¡¹ç›®é…ç½®ã€‚

#### `/.github` - GitHub é…ç½®
GitHub Actions å·¥ä½œæµå’Œå…¶ä»– GitHub ç›¸å…³é…ç½®ã€‚

#### `/.devcontainer` - å¼€å‘å®¹å™¨é…ç½®
ç”¨äºå®¹å™¨åŒ–å¼€å‘ç¯å¢ƒçš„é…ç½®ã€‚

#### `/.husky` - Git Hooks
Git æäº¤é’©å­é…ç½®ï¼Œç”¨äºä»£ç è´¨é‡æ£€æŸ¥ã€‚

## ğŸš€ å¼€å‘å·¥ä½œæµ

### å¯åŠ¨å¼€å‘ç¯å¢ƒ
```bash
npm start                    # å¯åŠ¨åº”ç”¨
npm run dev:engine          # ä½¿ç”¨æœ¬åœ°å¼•æ“å¯åŠ¨
npm run staging:engine      # ä½¿ç”¨é¢„å‘å¸ƒå¼•æ“å¯åŠ¨
```

### ä»£ç è´¨é‡
```bash
npm run lint                # ä»£ç æ£€æŸ¥
npm run prettier           # ä»£ç æ ¼å¼åŒ–
npm run presubmit          # æäº¤å‰æ£€æŸ¥
```

### æµ‹è¯•
```bash
npm test                    # è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:watch         # ç›‘è§†æ¨¡å¼æµ‹è¯•
npm run e2e                # ç«¯åˆ°ç«¯æµ‹è¯•
```

### æ•°æ®åº“
```bash
npm run db:generate        # ç”Ÿæˆæ•°æ®åº“è¿ç§»
npm run db:push           # æ¨é€æ•°æ®åº“å˜æ›´
npm run db:studio         # æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
```

### æ„å»ºå’Œå‘å¸ƒ
```bash
npm run package           # æ‰“åŒ…åº”ç”¨
npm run make             # æ„å»ºå®‰è£…åŒ…
npm run publish          # å‘å¸ƒåº”ç”¨
```

## ğŸ›ï¸ æ¶æ„ç‰¹ç‚¹

### IPC æ¶æ„
1. **æ¸²æŸ“è¿›ç¨‹** (`src/ipc/ipc_client.ts`) - é€šè¿‡ `IpcClient.getInstance()` è®¿é—®
2. **é¢„åŠ è½½è„šæœ¬** (`src/preload.ts`) - å®šä¹‰æ¸²æŸ“è¿›ç¨‹å…è®¸åˆ—è¡¨
3. **ä¸»è¿›ç¨‹** (`src/ipc/ipc_host.ts`) - æ³¨å†Œ `/handlers` ç›®å½•ä¸‹çš„å¤„ç†å™¨

### React + IPC é›†æˆæ¨¡å¼
- **è¯»å–æ“ä½œ**: ä½¿ç”¨ `useQuery` åŒ…è£…ï¼Œæä¾›ç¨³å®šçš„ `queryKey`
- **å†™å…¥æ“ä½œ**: ä½¿ç”¨ `useMutation`ï¼Œæœ¬åœ°éªŒè¯è¾“å…¥ï¼ŒæˆåŠŸåå¤±æ•ˆç›¸å…³æŸ¥è¯¢
- **çŠ¶æ€åŒæ­¥**: é€šè¿‡ `useEffect` åœ¨éœ€è¦æ—¶åŒæ­¥ TanStack Query æ•°æ®ä¸å…¨å±€çŠ¶æ€

### å®‰å…¨å®è·µ
- æ—  `remote` æ¨¡å—ä½¿ç”¨
- é€šè¿‡ `appId` éªŒè¯å’Œé”å®šå…±äº«èµ„æºå˜æ›´
- ä¸¥æ ¼çš„ IPC è¾¹ç•Œæ§åˆ¶

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `src/ipc/handlers/` æ·»åŠ  IPC å¤„ç†å™¨
2. åœ¨ `src/preload.ts` ä¸­æ·»åŠ æ¸²æŸ“è¿›ç¨‹ API
3. åœ¨ `src/ipc/ipc_client.ts` ä¸­æ·»åŠ å®¢æˆ·ç«¯æ–¹æ³•
4. åˆ›å»ºç›¸åº”çš„ React Hook å’Œç»„ä»¶
5. æ·»åŠ æµ‹è¯•æ–‡ä»¶

### å‘½åçº¦å®š
- ä½¿ç”¨æè¿°æ€§çš„æ¨¡å—/å‡½æ•°åï¼Œåæ˜  IPC é€šé“è¯­ä¹‰
- ä¿æŒ Electron å®‰å…¨å®è·µ
- IPC å¤„ç†å™¨å¤±è´¥æ—¶æŠ›å‡º `Error` è€Œä¸æ˜¯è¿”å› `{ success: false }`

è¿™ä¸ªæ¶æ„ç¡®ä¿äº†åº”ç”¨çš„å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œè‰¯å¥½çš„å¼€å‘ä½“éªŒã€‚